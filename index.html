<!DOCTYPE html>
<html>
  <head>
    <title>Random YouTube Player</title>
    <style>
      body {
        position: relative;
        height: 100vh;
        margin: 0;
        padding: 0;
        background: black;
        color: white;
        font-family: Arial, sans-serif;
      }
      #top-bar {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 5px;
        background: rgba(255, 107, 107, 0.5);
        z-index: 10;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .grab-bar {
        display: none;
        width: 40px;
        height: 3px;
        background: #ff6b6b;
        position: relative;
      }
      .grab-bar::before,
      .grab-bar::after {
        content: '';
        position: absolute;
        width: 40px;
        height: 3px;
        background: #ff6b6b;
        left: 0;
      }
      .grab-bar::before {
        top: -6px;
      }
      .grab-bar::after {
        top: 6px;
      }
      #top-bar:hover .grab-bar {
        display: block;
      }
      #top {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
        transform: translateY(-100%);
        transition: transform 0.3s ease;
        z-index: 5;
      }
      #top-bar:hover + #top, #top:hover {
        transform: translateY(0);
      }
      #countdown {
        font-size: 32px;
        font-weight: bold;
        margin-right: 20px;
        color: #ff6b6b;
      }
      button {
        background: none;
        border: 2px solid #ff6b6b;
        color: #ff6b6b;
        font-size: 24px;
        padding: 10px 15px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      button:hover {
        background: #ff6b6b;
        color: black;
        transform: scale(1.1);
      }
      #player {
        height: 100%;
      }
      #player iframe {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="top-bar">
      <div class="grab-bar"></div>
    </div>
    <div id="top">
      <div id="countdown">30</div>
      <button onclick="loadRandomVideo()">ðŸ”€</button>
    </div>

    <!-- This is where the player will appear -->
    <div id="player"></div>

    <!-- Load YouTube iframe API -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
      let player;
      let countdownInterval;
      let timeLeft = 30;

      function startCountdown(time = 30) {
        timeLeft = time;
        clearInterval(countdownInterval);
        document.getElementById('countdown').textContent = timeLeft;
        countdownInterval = setInterval(() => {
          timeLeft--;
          document.getElementById('countdown').textContent = timeLeft;
          if (timeLeft <= 0) {
            clearInterval(countdownInterval);
            loadRandomVideo();
          }
        }, 1000);
      }

      function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING) {
          startCountdown(timeLeft);
        } else {
          clearInterval(countdownInterval);
        }
      }

      // Called automatically by the YouTube API
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '100%',
          width: '100%',
          videoId: '', // weâ€™ll set this later
          playerVars: {
            autoplay: 1,
            controls: 0,
            mute: 0        // stops browser blocking autoplay
          },
          events: {
            'onReady': loadRandomVideo,
            'onStateChange': onPlayerStateChange
          }
        });
      }

      function loadRandomVideo() {
        fetch('/random-video')
        .then(res => res.json())
        .then(data => {
      // stop previous video (optional but safer)
        if (player.getPlayerState() === YT.PlayerState.PLAYING) {
            player.stopVideo();
        }

        player.loadVideoById({
        videoId: data.videoId,
        startSeconds: data.timestamp
      });
      startCountdown(30);
    });
}

    </script>
  </body>
</html>
