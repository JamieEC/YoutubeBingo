<!DOCTYPE html>
<html>
  <head>
    <title>Nevo Bingo</title>
    <style>
      body {
        position: relative;
        height: 100vh;
        margin: 0;
        padding: 0;
        background: black;
        color: white;
        font-family: Arial, sans-serif;
      }
      #top {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
        transform: translateY(-100%);
        transition: transform 0.3s ease;
        z-index: 5;
        width: fit-content;
        justify-self: center;
      }
      #top.visible {
        transform: translateY(0);
      }
      #countdown {
        font-size: 32px;
        font-weight: bold;
        margin-right: 20px;
        color: #ff6b6b;
      }
      button {
        background: none;
        border: 2px solid #ff6b6b;
        color: #ff6b6b;
        font-size: 24px;
        padding: 10px 15px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      button:hover {
        background: #ff6b6b;
        color: black;
        transform: scale(1.1);
      }
      #player {
        height: 100%;
      }
      #player iframe {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="top">
      <div id="countdown">30</div>
      <button onclick="loadRandomVideo()">ðŸ”€</button>
    </div>

    <!-- Touch overlay to capture touches over the player -->
    <div id="touch-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 1;"></div>

    <!-- This is where the player will appear -->
    <div id="player"></div>

    <!-- Load YouTube iframe API -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
      let player;
      let countdownInterval;
      let timeLeft = 30;
      let hideTimeout;
      let isHoveringTop = false;

      document.addEventListener('mousemove', () => {
        const topEl = document.getElementById('top');
        topEl.classList.add('visible');
      });

      document.getElementById('top').addEventListener('mouseenter', () => {
        isHoveringTop = true;
        clearTimeout(hideTimeout);
      });

      document.getElementById('top').addEventListener('mouseleave', () => {
        isHoveringTop = false;
        hideTimeout = setTimeout(() => {
          document.getElementById('top').classList.remove('visible');
        }, 3000);
      });

      document.getElementById('touch-overlay').addEventListener('touchstart', () => {
        const topEl = document.getElementById('top');
        topEl.classList.add('visible');
        if (!isHoveringTop) {
          clearTimeout(hideTimeout);
          hideTimeout = setTimeout(() => {
            topEl.classList.remove('visible');
          }, 3000);
        }
      });

      document.getElementById('top').addEventListener('touchstart', () => {
        isHoveringTop = true;
        clearTimeout(hideTimeout);
      });

      document.getElementById('top').addEventListener('touchend', () => {
        isHoveringTop = false;
        hideTimeout = setTimeout(() => {
          document.getElementById('top').classList.remove('visible');
        }, 3000);
      });

      function startCountdown(time = 30) {
        timeLeft = time;
        clearInterval(countdownInterval);
        document.getElementById('countdown').textContent = timeLeft;
        countdownInterval = setInterval(() => {
          timeLeft--;
          document.getElementById('countdown').textContent = timeLeft;
          if (timeLeft <= 0) {
            clearInterval(countdownInterval);
            loadRandomVideo();
          }
        }, 1000);
      }

      function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING) {
          startCountdown(timeLeft);
        } else {
          clearInterval(countdownInterval);
        }
      }

      // Called automatically by the YouTube API
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '100%',
          width: '100%',
          videoId: '', // weâ€™ll set this later
          playerVars: {
            autoplay: 1,
            controls: 0,
            mute: 0        // stops browser blocking autoplay
          },
          events: {
            'onReady': loadRandomVideo,
            'onStateChange': onPlayerStateChange
          }
        });
      }

      function loadRandomVideo() {
        fetch('/random-video')
        .then(res => res.json())
        .then(data => {
      // stop previous video (optional but safer)
        if (player.getPlayerState() === YT.PlayerState.PLAYING) {
            player.stopVideo();
        }

        player.loadVideoById({
        videoId: data.videoId,
        startSeconds: data.timestamp
      });
      startCountdown(30);
    });
}

    </script>
  </body>
</html>
